<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Building a Language Model for Chinese Numbers using LSTM and GRU | PeiyiHung</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Building a Language Model for Chinese Numbers using LSTM and GRU" />
<meta name="author" content="Peiyi Hung" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Make a dataset of Chinese numbers and train language models for it with LSTM and GRU which are built from scratch." />
<meta property="og:description" content="Make a dataset of Chinese numbers and train language models for it with LSTM and GRU which are built from scratch." />
<link rel="canonical" href="https://peiyihung.github.io/mywebsite/category/project/ingdeep%20learning/rnn/fastai/pytorch/2021/02/21/Chinese_numbers.html" />
<meta property="og:url" content="https://peiyihung.github.io/mywebsite/category/project/ingdeep%20learning/rnn/fastai/pytorch/2021/02/21/Chinese_numbers.html" />
<meta property="og:site_name" content="PeiyiHung" />
<meta property="og:image" content="https://peiyihung.github.io/mywebsite/images/vanillaRNN.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-21T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"Make a dataset of Chinese numbers and train language models for it with LSTM and GRU which are built from scratch.","url":"https://peiyihung.github.io/mywebsite/category/project/ingdeep%20learning/rnn/fastai/pytorch/2021/02/21/Chinese_numbers.html","@type":"BlogPosting","headline":"Building a Language Model for Chinese Numbers using LSTM and GRU","dateModified":"2021-02-21T00:00:00-06:00","datePublished":"2021-02-21T00:00:00-06:00","author":{"@type":"Person","name":"Peiyi Hung"},"image":"https://peiyihung.github.io/mywebsite/images/vanillaRNN.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://peiyihung.github.io/mywebsite/category/project/ingdeep%20learning/rnn/fastai/pytorch/2021/02/21/Chinese_numbers.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/mywebsite/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://peiyihung.github.io/mywebsite/feed.xml" title="PeiyiHung" /><link rel="shortcut icon" type="image/x-icon" href="/mywebsite/images/py.ico">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/mywebsite/">PeiyiHung</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/mywebsite/about/">About me</a><a class="page-link" href="/mywebsite/learning/">Learning</a><a class="page-link" href="/mywebsite/projects/">Projects</a><a class="page-link" href="/mywebsite/search/">Search</a><a class="page-link" href="/mywebsite/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Building a Language Model for Chinese Numbers using LSTM and GRU</h1><p class="page-description">Make a dataset of Chinese numbers and train language models for it with LSTM and GRU which are built from scratch.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-02-21T00:00:00-06:00" itemprop="datePublished">
        Feb 21, 2021
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Peiyi Hung</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      11 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/mywebsite/categories/#category">category</a>
        &nbsp;
      
        <a class="category-tags-link" href="/mywebsite/categories/#project">project</a>
        &nbsp;
      
        <a class="category-tags-link" href="/mywebsite/categories/#ingdeep learning">ingdeep learning</a>
        &nbsp;
      
        <a class="category-tags-link" href="/mywebsite/categories/#RNN">RNN</a>
        &nbsp;
      
        <a class="category-tags-link" href="/mywebsite/categories/#fastai">fastai</a>
        &nbsp;
      
        <a class="category-tags-link" href="/mywebsite/categories/#pytorch">pytorch</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/peiyiHung/mywebsite/tree/master/_notebooks/2021-02-21-Chinese_numbers.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/mywebsite/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/peiyiHung/mywebsite/master?filepath=_notebooks%2F2021-02-21-Chinese_numbers.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/mywebsite/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/peiyiHung/mywebsite/blob/master/_notebooks/2021-02-21-Chinese_numbers.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/mywebsite/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Introduction">Introduction </a></li>
<li class="toc-entry toc-h1"><a href="#Generate-data">Generate data </a></li>
<li class="toc-entry toc-h1"><a href="#Tokenization-and-Numericalization">Tokenization and Numericalization </a></li>
<li class="toc-entry toc-h1"><a href="#Dataloaders">Dataloaders </a></li>
<li class="toc-entry toc-h1"><a href="#Models">Models </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Vanilla-RNN">Vanilla RNN </a></li>
<li class="toc-entry toc-h2"><a href="#Two-layered-RNN">Two-layered RNN </a></li>
<li class="toc-entry toc-h2"><a href="#LSTM">LSTM </a></li>
<li class="toc-entry toc-h2"><a href="#Two-layered-LSTM">Two-layered LSTM </a></li>
<li class="toc-entry toc-h2"><a href="#GRU">GRU </a></li>
<li class="toc-entry toc-h2"><a href="#LSTM-+-Regularization-techniques">LSTM + Regularization techniques </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Summary">Summary </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-02-21-Chinese_numbers.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Introduction">
<a class="anchor" href="#Introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction<a class="anchor-link" href="#Introduction"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to better understand what are a language model and recurrent neural networks (RNN), I create a simple dataset on Chinese numbers and train various RNNs to build a language model of Chinese numbers in this project. The dataset contains Traditional Chinese characters of numbers from 0 to 9999 and I train models to predict the next Chinese number in the dataset.  Most models are built by common modules in Pytorch instead of off-the-shelf Pytorch RNN moduels. For example, I make LSTM cells using only <code>nn.Linear</code> rather than <code>nn.LSTM</code>. Only the last model are created using Pytorch's <code>nn.LSTM</code> and, by adding regularization techniques, it yields an accuracy of 96%. This project is inspired by the chapter 12 of <a href="https://github.com/fastai/fastbook">the fastai book</a> in which the author creates a dataset of English numbers and trains language models.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Generate-data">
<a class="anchor" href="#Generate-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generate data<a class="anchor-link" href="#Generate-data"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here's how I make this simple model of Chinese numbers:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.text.all</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># generate numbers from 0 to 9</span>
<span class="n">zero_to_nine</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"零"</span><span class="p">,</span> <span class="s2">"一"</span><span class="p">,</span> <span class="s2">"二"</span><span class="p">,</span> <span class="s2">"三"</span><span class="p">,</span> <span class="s2">"四"</span><span class="p">,</span> <span class="s2">"五"</span><span class="p">,</span> <span class="s2">"六"</span><span class="p">,</span> <span class="s2">"七"</span><span class="p">,</span> <span class="s2">"八"</span><span class="p">,</span> <span class="s2">"九"</span><span class="p">]</span>
<span class="n">num</span> <span class="o">=</span> <span class="n">zero_to_nine</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># 10 to 19</span>
<span class="n">ten_to_nineteen</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">zero_to_nine</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">"零"</span><span class="p">:</span>
        <span class="n">add</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">add</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">ten_to_nineteen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"十"</span> <span class="o">+</span> <span class="n">add</span><span class="p">)</span>
<span class="n">num</span> <span class="o">+=</span> <span class="n">ten_to_nineteen</span>

<span class="c1"># 20 to 99</span>
<span class="n">ten_to_hundred</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">zero_to_nine</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ten_to_nineteen</span><span class="p">]</span>
<span class="n">num</span> <span class="o">+=</span> <span class="n">ten_to_hundred</span>

<span class="c1"># 100 to 999</span>
<span class="n">hundred_to_thousand</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">zero_to_nine</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">hundred_to_thousand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">"百"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">zero_to_nine</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">hundred_to_thousand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">"百"</span> <span class="o">+</span> <span class="s2">"零"</span> <span class="o">+</span> <span class="n">g</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ten_to_nineteen</span><span class="p">:</span>
        <span class="n">hundred_to_thousand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">"百"</span> <span class="o">+</span> <span class="s2">"一"</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ten_to_hundred</span><span class="p">:</span>
        <span class="n">hundred_to_thousand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">"百"</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
<span class="n">num</span> <span class="o">+=</span> <span class="n">hundred_to_thousand</span>

<span class="c1"># 999 to 9999</span>
<span class="n">thousand_tenthousand</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">zero_to_nine</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">thousand_tenthousand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">"千"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">zero_to_nine</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">thousand_tenthousand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">"千"</span> <span class="o">+</span> <span class="s2">"零"</span> <span class="o">+</span> <span class="n">g</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ten_to_nineteen</span><span class="p">:</span>
        <span class="n">thousand_tenthousand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">"千"</span> <span class="o">+</span> <span class="s2">"零"</span><span class="o">+</span> <span class="s2">"一"</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ten_to_hundred</span><span class="p">:</span>
        <span class="n">thousand_tenthousand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">"千"</span> <span class="o">+</span> <span class="s2">"零"</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">hundred_to_thousand</span><span class="p">:</span>
        <span class="n">thousand_tenthousand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">"千"</span> <span class="o">+</span> <span class="n">o</span><span class="p">)</span>

<span class="n">num</span> <span class="o">+=</span> <span class="n">thousand_tenthousand</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's take a look at the dataset:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>10000</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">111</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>['一百',
 '一百零一',
 '一百零二',
 '一百零三',
 '一百零四',
 '一百零五',
 '一百零六',
 '一百零七',
 '一百零八',
 '一百零九',
 '一百一十']</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The numbers in the dataset are from 0 to 9999, so there are 10000 data points in it. If you want to save this dataset, you can uncomment and execute the following codes:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># with open("chinese_numbers.txt", "w") as text_file:</span>
<span class="c1">#     text_file.write("\n".join(num))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Tokenization-and-Numericalization">
<a class="anchor" href="#Tokenization-and-Numericalization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tokenization and Numericalization<a class="anchor-link" href="#Tokenization-and-Numericalization"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before we delve into modeling, we should first make our dataset understandable by the model. That is, we should tokenize the data and numericalize the tokens.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Tokenization is to transfer each Chinese character into a token.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tokens</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="s2">"."</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="p">)</span>
<span class="n">tokens</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#74691) ['零','.','一','.','二','.','三','.','四','.'...]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>vocab</code> is the collection of unique tokens.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vocab</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="o">*</span><span class="n">tokens</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Numericalization is to map a token to a non-negative number so as to be taken by the <code>nn.Embedding</code> layer of RNNs.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">word2idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">w</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vocab</span><span class="p">)}</span>
<span class="n">nums</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">word2idx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">)</span>
<span class="n">nums</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#74691) [0,1,2,1,3,1,4,1,5,1...]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Dataloaders">
<a class="anchor" href="#Dataloaders" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dataloaders<a class="anchor-link" href="#Dataloaders"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, we rearrange the data into batches and form the dataloaders</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">group_chunks</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">bs</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">//</span> <span class="n">bs</span>
    <span class="n">new_ds</span> <span class="o">=</span> <span class="n">L</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span> <span class="n">new_ds</span> <span class="o">+=</span> <span class="n">L</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">m</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bs</span><span class="p">))</span> 
    <span class="k">return</span> <span class="n">new_ds</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sl</span> <span class="o">=</span> <span class="mi">16</span> <span class="c1"># sequence length</span>
<span class="n">bs</span> <span class="o">=</span> <span class="mi">32</span> <span class="c1"># batch size</span>
<span class="n">seqs</span> <span class="o">=</span> <span class="n">L</span><span class="p">((</span><span class="n">tensor</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">sl</span><span class="p">]),</span> <span class="n">tensor</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">sl</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span><span class="o">-</span><span class="n">sl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">sl</span><span class="p">))</span>
<span class="n">cut</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seqs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dsets</span><span class="p">(</span><span class="n">group_chunks</span><span class="p">(</span><span class="n">seqs</span><span class="p">[:</span><span class="n">cut</span><span class="p">],</span> <span class="n">bs</span><span class="p">),</span>
                             <span class="n">group_chunks</span><span class="p">(</span><span class="n">seqs</span><span class="p">[</span><span class="n">cut</span><span class="p">:],</span> <span class="n">bs</span><span class="p">),</span>
                             <span class="n">bs</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's see how the data is formed in a batch:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xs</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L</span><span class="p">(</span><span class="n">vocab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#16) ['零','.','一','.','二','.','三','.','四','.'...]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L</span><span class="p">(</span><span class="n">vocab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#16) ['.','一','.','二','.','三','.','四','.','五'...]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For each time step, the model is predicting the next word given previous word, so the independent variable is a sequence of tokens and the target would be the next word.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Models">
<a class="anchor" href="#Models" aria-hidden="true"><span class="octicon octicon-link"></span></a>Models<a class="anchor-link" href="#Models"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this section, I create RNN models for the language model task. Here's a list of models:</p>
<ul>
<li>vanilla RNN</li>
<li>two-layered RNN</li>
<li>LSTM</li>
<li>two-layered LSTM</li>
<li>GRU</li>
<li>LSTM + regularization </li>
</ul>
<p>The last one uses Pytorch's <code>nn.LSTM</code>, while the rest only use <code>nn.Linear</code> and <code>nn.Embedding</code> modules. All the models would be trained using cross entropy as loss function, Adam as optimization method and accuracy as evaluation metric.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Vanilla-RNN">
<a class="anchor" href="#Vanilla-RNN" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vanilla RNN<a class="anchor-link" href="#Vanilla-RNN"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The first model is a RNN with only plain linear layers in it.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">VanillaRNN</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_h</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">h_h</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>     
        <span class="bp">self</span><span class="o">.</span><span class="n">h_o</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span><span class="n">vocab_sz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># walking through each time step</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sl</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_h</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_h</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
            <span class="n">outs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_o</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">outs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">loss_func</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">targ</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)),</span> <span class="n">targ</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This model is composed of:</p>
<ul>
<li>
<code>self.i_h</code>: an embedding layer (<code>nn.Embedding</code>) taking into a index of a token and return the embedding vector of a token.</li>
<li>
<code>self.h_h</code>: a plain linear layer taking the vector of word and performing linear transformation</li>
<li>
<code>self.h_o</code>: the output layer generating the probability of being each word in the <code>vocab</code>
</li>
<li>
<code>self.h</code>: the hidden state of the RNN</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's train this model:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn1</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">VanillaRNN</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">128</span><span class="p">),</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">loss_func</span><span class="p">,</span>
                <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">ModelResetter</span><span class="p">)</span>
<span class="n">learn1</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(lr_min=0.010000000149011612, lr_steep=0.009120108559727669)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn1</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.479430</td>
      <td>1.525608</td>
      <td>0.455280</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.121994</td>
      <td>1.544240</td>
      <td>0.526670</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.921751</td>
      <td>1.768980</td>
      <td>0.579270</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.737316</td>
      <td>1.990620</td>
      <td>0.618400</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.612017</td>
      <td>2.001600</td>
      <td>0.637998</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.520435</td>
      <td>2.110346</td>
      <td>0.662985</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.432043</td>
      <td>2.188616</td>
      <td>0.696862</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.357842</td>
      <td>2.515358</td>
      <td>0.727910</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.302256</td>
      <td>2.760709</td>
      <td>0.741110</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.252840</td>
      <td>2.879565</td>
      <td>0.750606</td>
      <td>00:01</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We get 75% accuracy after 10 epochs.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Two-layered-RNN">
<a class="anchor" href="#Two-layered-RNN" aria-hidden="true"><span class="octicon octicon-link"></span></a>Two-layered RNN<a class="anchor-link" href="#Two-layered-RNN"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can stack multiple linear layers in a RNN to make you model more powerful. Here I make a two-layered one.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TwoLayersRNN</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_h</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_h1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_h2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_o</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h2</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sl</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_h</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h1</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_h1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">h1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h2</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_h2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h2</span><span class="p">))</span>
            <span class="n">outs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_o</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h1</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h2</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">outs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">h1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h2</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This model is also a RNN with plain linear layers but it has two linear layers. You can find the two linear layers in the codes:<code>self.h_h1</code> and <code>self.h_h2</code>. Let's see if it can outperform the single-layered one.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn2</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">TwoLayersRNN</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">128</span><span class="p">),</span> 
                <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">ModelResetter</span><span class="p">)</span>
<span class="n">learn2</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(lr_min=0.010000000149011612, lr_steep=0.005248074419796467)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn2</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.432051</td>
      <td>1.517559</td>
      <td>0.454337</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.138805</td>
      <td>1.898586</td>
      <td>0.539601</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.823014</td>
      <td>2.276638</td>
      <td>0.555900</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.629227</td>
      <td>1.774288</td>
      <td>0.618871</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.507961</td>
      <td>1.674384</td>
      <td>0.629782</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.400248</td>
      <td>1.949680</td>
      <td>0.659079</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.352511</td>
      <td>1.605654</td>
      <td>0.693427</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.252898</td>
      <td>1.634336</td>
      <td>0.752155</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.212198</td>
      <td>1.842869</td>
      <td>0.764547</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.177986</td>
      <td>1.873169</td>
      <td>0.770205</td>
      <td>00:02</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This model get 2% increase in accuracy also with 10 epcohs as the previous one.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The vanilla RNN severely suffers from the vanishing gradient problem. To resolve the problem, several cell architectures are designed including <a href="https://www.bioinf.jku.at/publications/older/2604.pdf">Long Short-term Memory (LSTM)</a> and <a href="https://arxiv.org/abs/1406.1078v3">Gated Recurrent Unit (GRU)</a>. I would implement these two method with Pytorch in the following sections.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="LSTM">
<a class="anchor" href="#LSTM" aria-hidden="true"><span class="octicon octicon-link"></span></a>LSTM<a class="anchor-link" href="#LSTM"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Instead of using a linear layer, LSTM use a specially designed cells in a RNN. Here's the cell in codes:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">LSTMCell</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="n">nh</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forget_gate</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">ni</span><span class="o">+</span><span class="n">nh</span><span class="p">,</span> <span class="n">nh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_gate</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">ni</span><span class="o">+</span><span class="n">nh</span><span class="p">,</span> <span class="n">nh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outout_gate</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">ni</span><span class="o">+</span><span class="n">nh</span><span class="p">,</span> <span class="n">nh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_gate</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">ni</span><span class="o">+</span><span class="n">nh</span><span class="p">,</span> <span class="n">nh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_size</span> <span class="o">=</span> <span class="n">ni</span><span class="o">+</span><span class="n">nh</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="c1"># h and c from last time step, concatenate them into a single vector</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">state</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">input_</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_size</span><span class="p">)</span>
        
        <span class="c1"># gates</span>
        <span class="n">forget</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forget_gate</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_gate</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outout_gate</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
        
        <span class="c1"># update or forget content</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_gate</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">forget</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">inp</span><span class="o">*</span><span class="n">cell</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">output</span>
        <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        

<span class="c1"># build a RNN applying LSTM cell</span>
<span class="k">class</span> <span class="nc">MyLSTM</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_h</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span> <span class="o">=</span> <span class="n">LSTMCell</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_o</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sl</span><span class="p">):</span>
            <span class="n">output</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i_h</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="n">state</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_o</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In a LSTM architecture, two states would be passed through the network: hidden state <code>h</code> and cell state <code>c</code>. Hidden state <code>h</code> would be passed into three gates: forget gate, input gate, and output gate.</p>

<pre><code>forget = torch.sigmoid(self.forget_gate(h))
inp = torch.sigmoid(self.input_gate(h))
output = torch.sigmoid(self.outout_gate(h))</code></pre>
<p>Since these three gates all use sigmoid function as activation function, they would produce three scores ranging from 0 to 1. A new cell state would be computed by passing hidden state <code>h</code> into <code>self.cell_gate</code> and <code>torch.tanh</code>.</p>

<pre><code>cell = torch.tanh(self.cell_gate(h))</code></pre>
<p>The update version of cell state would be a weighted average of the previous cell state and the one that's newly computed. The weights are the output of forget gate and input gate.</p>

<pre><code>c = forget * c + inp*cell</code></pre>
<p>This new cell state would also be passed into a <code>torch.tanh</code> and times the output of output gate becoming the new hidden state <code>h</code>.</p>

<pre><code>h = torch.tanh(c) * output</code></pre>
<p>There are two sets of output of the LSTM cell: <code>h</code> is the output of each time step and <code>(h, c)</code> are the states passed into the next time step.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn3</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">MyLSTM</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">128</span><span class="p">),</span> 
                <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">ModelResetter</span><span class="p">)</span>
<span class="n">learn3</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(lr_min=0.04365158379077912, lr_steep=0.009120108559727669)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn3</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.564131</td>
      <td>1.658502</td>
      <td>0.413254</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.132675</td>
      <td>1.635722</td>
      <td>0.495824</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.874189</td>
      <td>1.553444</td>
      <td>0.536099</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.682400</td>
      <td>1.353059</td>
      <td>0.626549</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.529528</td>
      <td>1.235760</td>
      <td>0.652883</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.461710</td>
      <td>1.070935</td>
      <td>0.693023</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.435143</td>
      <td>1.129873</td>
      <td>0.695043</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.417539</td>
      <td>1.090291</td>
      <td>0.706897</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.400883</td>
      <td>1.208046</td>
      <td>0.708176</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.392933</td>
      <td>1.203122</td>
      <td>0.707099</td>
      <td>00:06</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Two-layered-LSTM">
<a class="anchor" href="#Two-layered-LSTM" aria-hidden="true"><span class="octicon octicon-link"></span></a>Two-layered LSTM<a class="anchor-link" href="#Two-layered-LSTM"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MyLSTM2</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">):</span>
        <span class="c1"># networks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_h</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnn1</span> <span class="o">=</span> <span class="n">LSTMCell</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnn2</span> <span class="o">=</span> <span class="n">LSTMCell</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_o</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">)</span>
        
        <span class="c1"># hidden states, 2 layers and 2 states each layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hs</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># initial hidden states</span>
        <span class="n">state1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">state2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
        
        <span class="c1"># go through all networks</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sl</span><span class="p">):</span>
            <span class="n">output</span><span class="p">,</span> <span class="n">state1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnn1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i_h</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="n">state1</span><span class="p">)</span>
            <span class="n">output</span><span class="p">,</span> <span class="n">state2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnn2</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">state2</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_o</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
            
        <span class="c1"># detach hidden states</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
            
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn4</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">MyLSTM2</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">128</span><span class="p">),</span> 
                <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">ModelResetter</span><span class="p">)</span>
<span class="n">learn4</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(lr_min=0.03630780577659607, lr_steep=0.019054606556892395)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn4</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">3e-2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.367824</td>
      <td>1.692747</td>
      <td>0.461072</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.101825</td>
      <td>1.752430</td>
      <td>0.499663</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.887319</td>
      <td>1.522436</td>
      <td>0.534079</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.752598</td>
      <td>1.426126</td>
      <td>0.591123</td>
      <td>00:07</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.645684</td>
      <td>1.208018</td>
      <td>0.659011</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.572723</td>
      <td>1.224382</td>
      <td>0.638200</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.514688</td>
      <td>1.094028</td>
      <td>0.664130</td>
      <td>00:06</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.484465</td>
      <td>1.107556</td>
      <td>0.669114</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.458131</td>
      <td>1.096884</td>
      <td>0.675647</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.444725</td>
      <td>1.108794</td>
      <td>0.673155</td>
      <td>00:05</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="GRU">
<a class="anchor" href="#GRU" aria-hidden="true"><span class="octicon octicon-link"></span></a>GRU<a class="anchor-link" href="#GRU"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GRUcell</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="n">nh</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_gate</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">ni</span><span class="o">+</span><span class="n">nh</span><span class="p">,</span> <span class="n">nh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_gate</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">ni</span><span class="o">+</span><span class="n">nh</span><span class="p">,</span> <span class="n">nh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_gate</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">ni</span><span class="o">+</span><span class="n">nh</span><span class="p">,</span> <span class="n">nh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_size</span> <span class="o">=</span> <span class="n">ni</span><span class="o">+</span><span class="n">nh</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="c1"># combine h from last time step and x from this time step</span>
        <span class="n">h_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_size</span><span class="p">)</span>
        
        <span class="c1"># update gate and reset gate</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_gate</span><span class="p">(</span><span class="n">h_t</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_gate</span><span class="p">(</span><span class="n">h_t</span><span class="p">))</span>
        
        <span class="c1"># update or rest content</span>
        <span class="n">rh</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">r</span>
        <span class="n">x_rh</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">rh</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_size</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g_gate</span><span class="p">(</span><span class="n">x_rh</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">z</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">z</span><span class="p">)</span><span class="o">*</span><span class="n">g</span>

<span class="k">class</span> <span class="nc">MyGRU</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_h</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span> <span class="o">=</span> <span class="n">GRUcell</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_o</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sl</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i_h</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_o</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn5</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">MyGRU</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">128</span><span class="p">),</span> 
                <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="n">ModelResetter</span><span class="p">)</span>
<span class="n">learn5</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(lr_min=0.02089296132326126, lr_steep=0.009120108559727669)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn5</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">5e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.505964</td>
      <td>1.656996</td>
      <td>0.391501</td>
      <td>00:03</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.137567</td>
      <td>1.522142</td>
      <td>0.539534</td>
      <td>00:03</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.768740</td>
      <td>1.856354</td>
      <td>0.604054</td>
      <td>00:03</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.494808</td>
      <td>1.249206</td>
      <td>0.647495</td>
      <td>00:03</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.296579</td>
      <td>1.079444</td>
      <td>0.737204</td>
      <td>00:03</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.154340</td>
      <td>0.889941</td>
      <td>0.789871</td>
      <td>00:03</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.091274</td>
      <td>0.959103</td>
      <td>0.833311</td>
      <td>00:03</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.057189</td>
      <td>0.823301</td>
      <td>0.849811</td>
      <td>00:03</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.032112</td>
      <td>0.825291</td>
      <td>0.856075</td>
      <td>00:03</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.024684</td>
      <td>0.823506</td>
      <td>0.856883</td>
      <td>00:03</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="LSTM-+-Regularization-techniques">
<a class="anchor" href="#LSTM-+-Regularization-techniques" aria-hidden="true"><span class="octicon octicon-link"></span></a>LSTM + Regularization techniques<a class="anchor-link" href="#LSTM-+-Regularization-techniques"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">LSTM_with_regularization</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_h</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_sz</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_o</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">vocab_sz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_o</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_h</span><span class="o">.</span><span class="n">weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_layers</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">raw</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i_h</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="n">h_</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="k">for</span> <span class="n">h_</span> <span class="ow">in</span> <span class="n">h</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_o</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="n">raw</span><span class="p">,</span><span class="n">out</span>
    
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">:</span> <span class="n">h</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn6</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">LSTM_with_regularization</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">),</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(),</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span>
                <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">ModelResetter</span><span class="p">,</span> <span class="n">RNNRegularizer</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span>
<span class="n">learn6</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(lr_min=0.10964782238006592, lr_steep=0.007585775572806597)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn6</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="n">wd</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.069000</td>
      <td>0.940814</td>
      <td>0.658540</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.348538</td>
      <td>0.325210</td>
      <td>0.894868</td>
      <td>00:04</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.183276</td>
      <td>0.245054</td>
      <td>0.917565</td>
      <td>00:04</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.138813</td>
      <td>0.188584</td>
      <td>0.956829</td>
      <td>00:04</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.114447</td>
      <td>0.170680</td>
      <td>0.958648</td>
      <td>00:04</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.102175</td>
      <td>0.182135</td>
      <td>0.954943</td>
      <td>00:04</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Summary">
<a class="anchor" href="#Summary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Summary<a class="anchor-link" href="#Summary"> </a>
</h1>
</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="peiyiHung/mywebsite"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/mywebsite/category/project/ingdeep%20learning/rnn/fastai/pytorch/2021/02/21/Chinese_numbers.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/mywebsite/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/mywebsite/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/mywebsite/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/peiyiHung" title="peiyiHung"><svg class="svg-icon grey"><use xlink:href="/mywebsite/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
